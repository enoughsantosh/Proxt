<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLS Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        .player-container:hover .controls {
            opacity: 1;
        }
        .scrubber:hover .scrubber-progress::after {
            opacity: 1;
        }
        .scrubber-progress::after {
            content: '';
            position: absolute;
            right: -5px;
            top: -3px;
            width: 12px;
            height: 12px;
            background: #3b82f6;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .loading-spinner {
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<div class="relative w-full max-w-4xl bg-black rounded-lg overflow-hidden shadow-xl player-container" id="player" style="max-height: 90vh;">
    <div class="relative w-full max-w-4xl bg-black rounded-lg overflow-hidden shadow-xl player-container" id="player">
        <video class="w-full" id="video" playsinline></video>
        
        <!-- Loading Indicator -->
        <div class="absolute inset-0 flex items-center justify-center hidden" id="loading">
            <div class="w-12 h-12 border-4 border-white/30 rounded-full loading-spinner"></div>
        </div>
        
        <!-- Error Display -->
        <div class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center p-6 hidden" id="error">
            <div class="text-white text-center mb-4" id="errorText"></div>
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" id="retry">Retry</button>
        </div>
        
        <!-- Controls Container -->
        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 transition-opacity duration-300 opacity-0 controls">
            <!-- Progress Bar -->
            <div class="w-full h-1.5 bg-gray-600 rounded-full mb-3 cursor-pointer scrubber" id="progressContainer">
                <div class="h-full bg-blue-500 rounded-full scrubber-progress" id="progressBar"></div>
            </div>
            
            <!-- Bottom Controls -->
            <div class="flex items-center justify-between">
                <!-- Left Controls -->
                <div class="flex items-center space-x-3">
                    <button class="text-white w-8 h-8 flex items-center justify-center" id="playPause">â–¶</button>
                    <div class="flex items-center space-x-2">
                        <button class="text-white w-6 h-6 flex items-center justify-center" id="mute">ðŸ”Š</button>
                        <input type="range" min="0" max="1" step="0.01" value="1" class="w-20 accent-blue-500" id="volume">
                    </div>
                    <div class="text-white text-sm" id="time">00:00 / 00:00</div>
                </div>
                
                <!-- Right Controls -->
                <div class="flex items-center space-x-3">
                    <select class="bg-gray-800 text-white text-xs rounded px-2 py-1" id="quality" disabled>
                        <option value="auto">Auto</option>
                    </select>
                    <select class="bg-gray-800 text-white text-xs rounded px-2 py-1" id="audio" disabled>
                        <option value="default">Default</option>
                    </select>
                    <button class="text-white w-8 h-8 flex items-center justify-center" id="fullscreen">â›¶</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    class HLSPlayer {
        constructor(containerId) {
            // Elements
            this.container = document.getElementById(containerId);
            this.video = this.container.querySelector('#video');
            this.loading = this.container.querySelector('#loading');
            this.error = this.container.querySelector('#error');
            this.errorText = this.container.querySelector('#errorText');
            this.retry = this.container.querySelector('#retry');
            this.playPause = this.container.querySelector('#playPause');
            this.mute = this.container.querySelector('#mute');
            this.volume = this.container.querySelector('#volume');
            this.progressContainer = this.container.querySelector('#progressContainer');
            this.progressBar = this.container.querySelector('#progressBar');
            this.timeDisplay = this.container.querySelector('#time');
            this.quality = this.container.querySelector('#quality');
            this.audio = this.container.querySelector('#audio');
            this.fullscreen = this.container.querySelector('#fullscreen');
            
            // State
            this.hls = null;
            this.url = '';
            this.progressInterval = null;
            this.controlsTimeout = null;
            this.showingControls = false;
            
            this.init();
        }
        
        init() {
            if (!Hls.isSupported()) {
                this.showError('Browser not supported');
                return;
            }
            
            this.hls = new Hls({
                enableWorker: true,
                xhrSetup: (xhr, url) => xhr.open('GET', this.proxyUrl(url), true)
            });
            this.hls.attachMedia(this.video);
            
            this.setupEvents();
        }
        
        proxyUrl(url) {
            return `/proxy?url=${encodeURIComponent(url)}`;
        }
        
        setupEvents() {
            // Play/Pause
            this.playPause.addEventListener('click', () => this.togglePlay());
            this.video.addEventListener('click', () => this.togglePlay());
            
            // Volume
            this.mute.addEventListener('click', () => this.toggleMute());
            this.volume.addEventListener('input', (e) => {
                this.video.volume = e.target.value;
                this.video.muted = e.target.value == 0;
                this.mute.textContent = e.target.value == 0 ? 'ðŸ”‡' : 'ðŸ”Š';
            });
            
            // Progress
            this.progressContainer.addEventListener('click', (e) => {
                const rect = this.progressContainer.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                this.video.currentTime = pos * this.video.duration;
            });
            
            // Time update
            this.video.addEventListener('timeupdate', () => this.updateTime());
            
            // Quality
            this.quality.addEventListener('change', (e) => {
                this.hls.currentLevel = e.target.value === 'auto' ? -1 : parseInt(e.target.value);
            });
            
            // Fullscreen
            this.fullscreen.addEventListener('click', () => this.toggleFullscreen());
            
            // Retry
            this.retry.addEventListener('click', () => this.load(this.url));
            
            // Mouse movement for controls
            this.container.addEventListener('mousemove', () => this.showControls());
            this.container.addEventListener('mouseleave', () => this.hideControls());
            
            // HLS events
            this.hls.on(Hls.Events.MEDIA_ATTACHED, () => console.log('Media attached'));
            this.hls.on(Hls.Events.MANIFEST_PARSED, (e, data) => this.setupTracks(data));
            this.hls.on(Hls.Events.ERROR, (e, data) => this.handleError(data));
        }
        
        load(url) {
            this.url = url;
            this.showLoading();
            this.hls.loadSource(this.proxyUrl(url));
            this.hls.startLoad();
        }
        
        togglePlay() {
            this.video.paused ? this.video.play() : this.video.pause();
        }
        
        toggleMute() {
            this.video.muted = !this.video.muted;
            this.mute.textContent = this.video.muted ? 'ðŸ”‡' : 'ðŸ”Š';
            this.volume.value = this.video.muted ? 0 : this.video.volume;
        }
        
        updateTime() {
            const current = this.formatTime(this.video.currentTime);
            const duration = this.formatTime(this.video.duration);
            this.timeDisplay.textContent = `${current} / ${duration}`;
            
            const percent = (this.video.currentTime / this.video.duration) * 100;
            this.progressBar.style.width = `${percent}%`;
        }
        
        formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        setupTracks(data) {
            this.hideLoading();
            
            // Quality levels
            this.quality.innerHTML = '<option value="auto">Auto</option>';
            if (data.levels && data.levels.length > 1) {
                data.levels.forEach((level, i) => {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = level.height ? `${level.height}p` : `${Math.round(level.bitrate/1000)}kbps`;
                    this.quality.appendChild(opt);
                });
                this.quality.disabled = false;
            }
            
            // Audio tracks
            this.audio.innerHTML = '<option value="default">Default</option>';
            if (data.audioTracks && data.audioTracks.length > 1) {
                data.audioTracks.forEach((track, i) => {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = track.name || track.lang || `Audio ${i+1}`;
                    this.audio.appendChild(opt);
                });
                this.audio.disabled = false;
            }
        }
        
        toggleFullscreen() {
            if (!document.fullscreenElement) {
                this.container.requestFullscreen().catch(console.error);
            } else {
                document.exitFullscreen();
            }
        }
        
        showControls() {
            clearTimeout(this.controlsTimeout);
            this.container.querySelector('.controls').style.opacity = '1';
            this.controlsTimeout = setTimeout(() => this.hideControls(), 3000);
        }
        
        hideControls() {
            if (!this.video.paused) {
                this.container.querySelector('.controls').style.opacity = '0';
            }
        }
        
        showLoading() {
            this.error.style.display = 'none';
            this.loading.style.display = 'flex';
        }
        
        hideLoading() {
            this.loading.style.display = 'none';
        }
        
        showError(message) {
            this.hideLoading();
            this.errorText.textContent = message;
            this.error.style.display = 'flex';
        }
        
        handleError(data) {
            let message = 'Playback error';
            if (data.fatal) {
                switch(data.type) {
                    case Hls.ErrorTypes.NETWORK_ERROR:
                        message = 'Network error';
                        break;
                    case Hls.ErrorTypes.MEDIA_ERROR:
                        message = 'Media error';
                        break;
                }
            }
            this.showError(message);
        }
    }

    // Initialize player
    document.addEventListener('DOMContentLoaded', () => {
        const player = new HLSPlayer('player');
        
const urlParams = new URLSearchParams(window.location.search);
const videoUrl = urlParams.get('url');
const vudeosUrl = proxyUrl(vudeoUrl);

if (videoUrl) {
    player.load(videosUrl);
} else {
    player.showError('No video URL provided');
}
        
        // Make available globally if needed
        window.hlsPlayer = player;
    });
    </script>
</body>
</html>
